local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local player = Players.LocalPlayer
local root = player.Character.HumanoidRootPart

-- ã€é—œéµä¿®æ­£ã€‘é›ªåœ°ä»»å‹™ NPC çš„ç²¾ç¢ºåº§æ¨™
-- å¿…é ˆç«™åœ¨é€™å€‹ä½ç½®ï¼Œä¼ºæœå™¨æ‰æœƒæ¥å—ä½ çš„è«‹æ±‚
local QuestNPC_CFrame = CFrame.new(1386, 87, -1298) 

local Config = {
    QuestName = "SnowQuest",
    QuestID = 1,
    WaitTime = 0.5 -- é£›åˆ°å¾Œç­‰å¾…å¤šä¹…æ‰æ¥ä»»å‹™ (å¤ªå¿«æœƒå¤±æ•—)
}

print("--- â„ï¸ [æ·±åº¦ä¿®æ­£] è·é›¢æª¢æ¸¬çªç ´ç‰ˆå•Ÿå‹• ---")

local function ForceAcceptQuest()
    -- 1. ç‚ºäº†ç¢ºä¿æˆåŠŸï¼Œå…ˆç¬ç§»åˆ° NPC é¢å‰
    print("ğŸ“ æ­£åœ¨ç§»å‹•åˆ° NPC æ—ä»¥é€šéè·é›¢æª¢æ¸¬...")
    player.Character.HumanoidRootPart.CFrame = QuestNPC_CFrame
    task.wait(Config.WaitTime) -- ç­‰å¾…ä¼ºæœå™¨ç¢ºèªä½ç½®

    -- 2. ç‚ºäº†é˜²æ­¢æœ‰éš±å½¢ä»»å‹™å¡ä½ï¼Œå…ˆç™¼é€ä¸€æ¬¡ã€Œæ”¾æ£„ä»»å‹™ã€
    ReplicatedStorage.Remotes.CommF_:InvokeServer("AbandonQuest")
    
    -- 3. æ­£å¼ç™¼é€æ¥ä»»å‹™è«‹æ±‚
    print("ğŸ“¨ ç™¼é€æ¥å–è«‹æ±‚...")
    local response = ReplicatedStorage.Remotes.CommF_:InvokeServer("StartQuest", Config.QuestName, Config.QuestID)
    -- æ³¨æ„ï¼šæœ‰äº›ç‰ˆæœ¬ä½¿ç”¨ "StartQuest" è€Œé "AcceptQuest"ï¼Œé€™è£¡åšäº†æ›¿æ›å˜—è©¦
    
    -- å¦‚æœ StartQuest æ²’åæ‡‰ï¼Œå˜—è©¦èˆŠç‰ˆ AcceptQuest
    if not response then
        response = ReplicatedStorage.Remotes.CommF_:InvokeServer("AcceptQuest", Config.QuestName, Config.QuestID)
    end

    print("ğŸ”„ ä¼ºæœå™¨å›æ‡‰ä»£ç¢¼: " .. tostring(response))
    
    return response
end

-- ç›£æ§å¾ªç’°
task.spawn(function()
    while true do
        local questUI = player.PlayerGui.Main:FindFirstChild("Quest")
        
        -- å¦‚æœ UI æ²’é¡¯ç¤ºï¼Œæˆ–è€…é¡¯ç¤ºäº†ä½†ä¸æ˜¯ Snow Banditsï¼Œå°±å¼·åˆ¶é‡æ¥
        if not questUI or not questUI.Visible then
            local result = ForceAcceptQuest()
            if result then
                print("âœ… ä»»å‹™æ¥å–æˆåŠŸï¼")
                -- æˆåŠŸå¾Œç¨å¾®å¾€ä¸Šé£›ï¼Œé¿å…è¢«æ€ªåœæ¯†
                root.CFrame = root.CFrame + Vector3.new(0, 10, 0)
                task.wait(2) -- æš«åœä¸€ä¸‹ç¢ºèªç‹€æ…‹
            end
        else
            -- ä»»å‹™å·²å­˜åœ¨ï¼Œåœæ­¢åˆ·å±
        end
        task.wait(2)
    end
end)
