local TweenService = game:GetService("TweenService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local player = Players.LocalPlayer

-- ã€æ ¸å¿ƒè¨­å®šã€‘
local TWEEN_SPEED = 300 -- å®‰å…¨æ»‘è¡Œé€Ÿåº¦
local WEAPON_NAME = "Cursed Dual Katana" -- ä½¿ç”¨ä½ èƒŒåŒ…ä¸­çš„æœ€å¼·æ­¦å™¨

-- ã€ä»»å‹™è·¯å¾‘æ¸…å–®ã€‘(åŒ…å« NPC åº§æ¨™èˆ‡æ€ªç‰©åç¨±)
local QuestChain = {
    {Name = "BanditQuest1", ID = 1, Mob = "Bandit", Pos = CFrame.new(1059, 16, 1549)},
    {Name = "JungleQuest", ID = 1, Mob = "Monkey", Pos = CFrame.new(-1598, 36, 153)},
    {Name = "JungleQuest", ID = 2, Mob = "Gorilla", Pos = CFrame.new(-1598, 36, 153)},
    {Name = "SnowQuest", ID = 1, Mob = "Snow Bandit", Pos = CFrame.new(1386, 87, -1298)},
    {Name = "SnowQuest", ID = 2, Mob = "Snowman", Pos = CFrame.new(1386, 87, -1298)}
}

local CurrentIndex = 1

-- 1. æ¥µé€Ÿæ»‘è¡Œå‡½æ•¸ (è§£æ±ºæ‹‰å›å•é¡Œ)
local function SafeMove(targetCFrame)
    local root = player.Character:WaitForChild("HumanoidRootPart")
    local distance = (root.Position - targetCFrame.p).Magnitude
    local tween = TweenService:Create(root, TweenInfo.new(distance/TWEEN_SPEED, Enum.EasingStyle.Linear), {CFrame = targetCFrame})
    
    -- é£›è¡Œä¿è­·ï¼šé˜²æ­¢æ‰è½
    local bv = Instance.new("BodyVelocity", root)
    bv.Velocity = Vector3.new(0,0,0)
    
    tween:Play()
    tween.Completed:Wait()
    bv:Destroy()
end

-- 2. æˆ°é¬¥é‚è¼¯ï¼šè‡ªå‹•ç æ®º
local function AutoKill(mobName)
    local weapon = player.Backpack:FindFirstChild(WEAPON_NAME) or player.Character:FindFirstChild(WEAPON_NAME)
    if weapon then player.Character.Humanoid:EquipTool(weapon) end
    
    while player.PlayerGui.Main.Quest.Visible do
        for _, enemy in pairs(game.Workspace.Enemies:GetChildren()) do
            if enemy.Name == mobName and enemy:FindFirstChild("Humanoid") and enemy.Humanoid.Health > 0 then
                -- é£›åˆ°æ€ªé ­ä¸Š 5 æ ¼
                player.Character.HumanoidRootPart.CFrame = enemy.HumanoidRootPart.CFrame * CFrame.new(0, 5, 0)
                game:GetService("VirtualUser"):Button1Down(Vector2.new(0,0))
                task.wait(0.1)
            end
        end
        task.wait(0.5)
    end
end

-- 3. ä¸»å¾ªç’°ï¼šå…¨åŸŸä»»å‹™æ¨é€²
task.spawn(function()
    print("ğŸš€ å•Ÿå‹• BM_20SHOP7202 ä¸€æµ·å…¨åŸŸä»»å‹™éˆ...")
    while CurrentIndex <= #QuestChain do
        local q = QuestChain[CurrentIndex]
        
        -- A. ç§»å‹•åˆ° NPC ä¸¦æ¥ä»»å‹™
        SafeMove(q.Pos)
        task.wait(0.5)
        ReplicatedStorage.Remotes.CommF_:InvokeServer("AbandonQuest")
        ReplicatedStorage.Remotes.CommF_:InvokeServer("StartQuest", q.Name, q.ID)
        
        -- B. é–‹å§‹æ‰“æ€ªç›´åˆ°ä»»å‹™å®Œæˆ
        if player.PlayerGui.Main.Quest.Visible then
            print("âš”ï¸ æ­£åœ¨åŸ·è¡Œ: " .. q.Mob)
            AutoKill(q.Mob)
            print("âœ… å®Œæˆ: " .. q.Mob)
            CurrentIndex = CurrentIndex + 1
        end
        task.wait(1)
    end
    print("ğŸ‰ ä¸€æµ·æ‰€æœ‰æ¸¬è©¦ä»»å‹™å·²å…¨æ•¸å®Œæˆï¼")
end)
