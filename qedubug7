local ReplicatedStorage = game:GetService("ReplicatedStorage")
local player = game.Players.LocalPlayer

-- ã€ä»»å‹™æ•¸æ“šåº«ã€‘è«‹æ ¹æ“šä½ æ¡é›†åˆ°çš„åç¨±å¡«å¯«
local QuestDatabase = {
    [2500] = {Name = "EliteHunter", ID = 1, NPC_Pos = CFrame.new(-1596, 37, 154)}, -- ç¯„ä¾‹
    [2660] = {Name = "FinalQuest", ID = 1, NPC_Pos = CFrame.new(-1438, 62, 4)}    -- ç¯„ä¾‹
}

print("--- [è‡ªå‹•åŒ–ä¸­å¿ƒ] å•Ÿå‹•ä¸­ ---")

-- 1. æª¢æŸ¥ç›®å‰æ˜¯å¦æœ‰ä»»å‹™
local function IsTaskActive()
    local mainGui = player.PlayerGui:FindFirstChild("Main")
    return mainGui and mainGui:FindFirstChild("Quest") and mainGui.Quest.Visible
end

-- 2. ç²å–é©åˆç›®å‰ç­‰ç´šçš„ä»»å‹™è³‡è¨Š
local function GetMyQuestData()
    local myLevel = player.Data.Level.Value
    local bestLevel = 0
    local selected = nil
    
    for level, data in pairs(QuestDatabase) do
        if myLevel >= level and level >= bestLevel then
            bestLevel = level
            selected = data
        end
    end
    return selected
end

-- 3. ä¸»å¾ªç’°ï¼šè‡ªå‹•æ¥ä»»å‹™
task.spawn(function()
    while task.wait(5) do
        if not IsTaskActive() then
            local data = GetMyQuestData()
            if data then
                print("ğŸ” ç™¼ç¾é©åˆä»»å‹™: " .. data.Name)
                
                -- é ç¨‹æ¥å–ä»»å‹™å”è­°
                local remote = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("CommF_")
                remote:InvokeServer("AcceptQuest", data.Name, data.ID)
                
                print("âœ… å·²å˜—è©¦è‡ªå‹•æ¥å–ä»»å‹™")
            end
        else
            print("â³ ç›®å‰ä»»å‹™åŸ·è¡Œä¸­...")
        end
    end
end)
