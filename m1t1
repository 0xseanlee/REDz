local Players = game:GetService("Players")
local VirtualUser = game:GetService("VirtualUser")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

-- è¨­å®šå…¨åŸŸè®Šæ•¸é–‹é—œï¼Œæ–¹ä¾¿ä½ éš¨æ™‚é—œé–‰
getgenv().AutoM1_Active = true

print("--- âš”ï¸ å•Ÿå‹•æ¥µé€Ÿæ™®æ”»ç³»çµ± (RenderStepped é©…å‹•) ---")
print("è‹¥è¦åœæ­¢ï¼Œè«‹åŸ·è¡Œ: getgenv().AutoM1_Active = false")

-- å®šç¾©æ ¸å¿ƒæ”»æ“Šå‡½æ•¸
local function AttemptAttack()
    -- 1. ç¢ºä¿è§’è‰²å­˜åœ¨
    local character = LocalPlayer.Character
    if not character then return end
    
    -- 2. ç²å–ç•¶å‰æ‰‹æŒçš„å·¥å…·
    local tool = character:FindFirstChildOfClass("Tool")
    
    if tool then
        -- ã€æ–¹æ¡ˆ Aã€‘: VirtualUser æ¨¡æ“¬æ»‘é¼ å·¦éµ (æœ€æ¨™æº–çš„æ–¹æ³•)
        pcall(function()
            VirtualUser:CaptureController()
            VirtualUser:Button1Down(Vector2.new(0, 0))
        end)
        
        -- ã€æ–¹æ¡ˆ Bã€‘: å¼·åˆ¶æ¿€æ´»å·¥å…· (é‡å° Mac åŸ·è¡Œå™¨æ¨¡æ“¬å¤±æ•ˆçš„å‚™æ¡ˆ)
        pcall(function()
            tool:Activate()
        end)
    end
end

-- ä½¿ç”¨ RenderStepped ç¶å®šæ¯ä¸€å¹€
-- é€™æ¯” while wait() å¿«å¾—å¤šï¼Œä¸”ä¸æœƒé€ æˆè…³æœ¬å»¶é²
local attackConnection
attackConnection = RunService.RenderStepped:Connect(function()
    if not getgenv().AutoM1_Active then
        if attackConnection then 
            attackConnection:Disconnect()
            print("ğŸ›‘ è‡ªå‹•æ™®æ”»å·²åœæ­¢")
        end
        return
    end
    
    AttemptAttack()
end)
