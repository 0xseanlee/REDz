local UIS = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")

-- ã€è¨­å®šå€ã€‘
local LogKey = Enum.KeyCode.P
local SendKey = Enum.KeyCode.Y
local WebhookURL = "https://discord.com/api/webhooks/1468528458056339529/WKTq9fLdmYaWVaM4b-yy78n9cEP5qB2NQx254k1pMLqJusi6HFefvtBL3vOaKznHoiFH"

local LastChatMessage = "æœªå‘½ååº§æ¨™"
local Locations = {}

-- ç›£è½èŠå¤© (ä¿®æ­£ç‰ˆï¼šç¢ºä¿èƒ½æŠ“åˆ°ç©å®¶è‡ªå·±çš„è¨Šæ¯)
Players.LocalPlayer.Chatted:Connect(function(msg)
    LastChatMessage = msg
    print("ğŸ“ ä¸‹ä¸€å€‹åº§æ¨™å‚™è¨»å·²è¨­ç‚º: " .. msg)
end)

-- åŸ·è¡Œè¨˜éŒ„åŠŸèƒ½
UIS.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    
    if input.KeyCode == LogKey then
        local character = Players.LocalPlayer.Character
        local root = character and character:FindFirstChild("HumanoidRootPart")
        
        if root then
            local cf = root.CFrame
            -- æ ¼å¼åŒ–ç‚ºç²¾ç°¡çš„ä»£ç¢¼æ ¼å¼
            local posString = string.format("CFrame.new(%.2f, %.2f, %.2f)", cf.Position.X, cf.Position.Y, cf.Position.Z)
            
            table.insert(Locations, {
                Note = LastChatMessage,
                Code = posString
            })
            print("âœ… å·²è¨˜éŒ„ [" .. LastChatMessage .. "]")
        end

    elseif input.KeyCode == SendKey then
        if #Locations == 0 then 
            print("âš ï¸ æ¸…å–®æ˜¯ç©ºçš„ï¼Œæ²’ä»€éº¼å¥½ç™¼é€çš„ã€‚") 
            return 
        end

        -- æ§‹å»º Discord è¨Šæ¯å…§å®¹
        local msgTable = {
            ["embeds"] = {{
                ["title"] = "ğŸ“ åº§æ¨™æ¡é›†å ±å‘Š",
                ["description"] = "```lua\nlocal Locations = {\n",
                ["color"] = 65280 -- ç¶ è‰²
            }}
        }

        for _, item in ipairs(Locations) do
            msgTable.embeds[1].description = msgTable.embeds[1].description .. '    ["' .. item.Note .. '"] = ' .. item.Code .. ",\n"
        end
        msgTable.embeds[1].description = msgTable.embeds[1].description .. "}\n```"

        -- ç™¼é€è«‹æ±‚ (ä½¿ç”¨ pcall é˜²æ­¢å™´éŒ¯)
        local success, response = pcall(function()
            return HttpService:PostAsync(WebhookURL, HttpService:JSONEncode(msgTable))
        end)

        if success then
            print("ğŸš€ æ•¸æ“šå·²æˆåŠŸé€é” Discordï¼")
            Locations = {} -- æ¸…ç©ºç·©å­˜
        else
            warn("âŒ ç™¼é€å¤±æ•—ï¼åŸå› : " .. tostring(response))
            print("è«‹æª¢æŸ¥æ˜¯å¦é–‹å•Ÿäº† Allow HTTP Requests æˆ– Webhook ç¶²å€æ˜¯å¦æ­£ç¢ºã€‚")
        end
    end
end)
