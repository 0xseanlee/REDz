local UIS = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")

-- è¨­å®šå€
local LogKey = Enum.KeyCode.P      -- æŒ‰ä¸‹ P è¨˜éŒ„
local SendKey = Enum.KeyCode.Y     -- æŒ‰ä¸‹ Y ç™¼é€åˆ° Discord
local WebhookURL = "https://discord.com/api/webhooks/1468528458056339529/WKTq9fLdmYaWVaM4b-yy78n9cEP5qB2NQx254k1pMLqJusi6HFefvtBL3vOaKznHoiFH"

local LastChatMessage = "ç„¡å‚™è¨»"
local Locations = {}

print("--- åº§æ¨™æ¡é›†å™¨å·²å•Ÿå‹• ---")
print("1. åœ¨èŠå¤©æ¡†è¼¸å…¥ NPC åç¨±æˆ–ç”¨é€”")
print("2. æŒ‰ä¸‹ 'P' è¨˜éŒ„åº§æ¨™èˆ‡å‚™è¨»")
print("3. æŒ‰ä¸‹ 'Y' å°‡æ‰€æœ‰æ¸…å–®ç™¼é€è‡³ Discord")

-- ç›£è½èŠå¤©è¨Šæ¯
Players.LocalPlayer.Chatted:Connect(function(msg)
    LastChatMessage = msg
    print("ç•¶å‰å‚™è¨»å·²æ›´æ–°ç‚º: " .. msg)
end)

-- è¨˜éŒ„åŠŸèƒ½
UIS.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    
    -- æŒ‰ä¸‹ P è¨˜éŒ„
    if input.KeyCode == LogKey then
        local root = Players.LocalPlayer.Character and Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if root then
            local cf = root.CFrame
            local posString = string.format("CFrame.new(%.2f, %.2f, %.2f)", cf.X, cf.Y, cf.Z)
            
            local data = {
                Note = LastChatMessage,
                Code = posString
            }
            table.insert(Locations, data)
            print("âœ… å·²è¨˜éŒ„: " .. LastChatMessage .. " -> " .. posString)
        end

    -- æŒ‰ä¸‹ Y ç™¼é€ Webhook
    elseif input.KeyCode == SendKey then
        if #Locations == 0 then print("âŒ æ¸…å–®ç‚ºç©ºï¼Œç„¡æ³•ç™¼é€") return end
        
        local content = "ğŸ“ **æ–°æ¡é›†çš„ Blox Fruit åº§æ¨™æ¸…å–®**:\n```lua\nlocal Locations = {\n"
        for _, item in ipairs(Locations) do
            content = content .. '    ["' .. item.Note .. '"] = ' .. item.Code .. ",\n"
        end
        content = content .. "}\n```"

        local payload = HttpService:JSONEncode({
            content = content,
            username = "åº§æ¨™æ¡é›†åŠ©æ‰‹"
        })

        -- ç™¼é€ POST è«‹æ±‚
        local success, err = pcall(function()
            HttpService:PostAsync(WebhookURL, payload)
        end)

        if success then
            print("ğŸš€ æ•¸æ“šå·²æˆåŠŸç™¼é€åˆ° Discordï¼")
            Locations = {} -- ç™¼é€å¾Œæ¸…ç©ºï¼Œé¿å…é‡è¤‡ç™¼é€
        else
            print("âš ï¸ ç™¼é€å¤±æ•—: " .. tostring(err))
        end
    end
end)
