local UIS = game:GetService("UserInputService")
local Players = game:GetService("Players")

-- ã€è¨­å®šå€ã€‘
local LogKey = Enum.KeyCode.P
local SendKey = Enum.KeyCode.Y
local WebhookURL = "https://discord.com/api/webhooks/1468528458056339529/WKTq9fLdmYaWVaM4b-yy78n9cEP5qB2NQx254k1pMLqJusi6HFefvtBL3vOaKznHoiFH"

local LastChatMessage = "æœªå‘½ååº§æ¨™"
local Locations = {}

-- åŸ·è¡Œå™¨å°ˆç”¨ç™¼é€å‡½æ•¸ (å…¼å®¹å¤šç¨®åŸ·è¡Œå™¨)
local function SendToDiscord(payload)
    local request = (syn and syn.request) or (http and http.request) or http_request or (fluxus and fluxus.request)
    if request then
        request({
            Url = WebhookURL,
            Method = "POST",
            Headers = {["Content-Type"] = "application/json"},
            Body = game:GetService("HttpService"):JSONEncode(payload)
        })
    else
        warn("âŒ ä½ çš„åŸ·è¡Œå™¨ä¸æ”¯æŒ http_request å‡½æ•¸")
    end
end

-- ç›£è½èŠå¤©
Players.LocalPlayer.Chatted:Connect(function(msg)
    LastChatMessage = msg
    print("ğŸ“ å‚™è¨»å·²æ›´æ–°: " .. msg)
end)

-- è¨˜éŒ„åŠŸèƒ½
UIS.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    
    if input.KeyCode == LogKey then
        local root = Players.LocalPlayer.Character and Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if root then
            local cf = root.CFrame
            local posString = string.format("CFrame.new(%.2f, %.2f, %.2f)", cf.X, cf.Y, cf.Z)
            table.insert(Locations, {Note = LastChatMessage, Code = posString})
            print("âœ… éŒ„å…¥: " .. LastChatMessage)
        end

    elseif input.KeyCode == SendKey then
        if #Locations == 0 then return end
        
        local desc = "```lua\nlocal Locations = {\n"
        for _, item in ipairs(Locations) do
            desc = desc .. '    ["' .. item.Note .. '"] = ' .. item.Code .. ",\n"
        end
        desc = desc .. "}\n```"

        SendToDiscord({
            embeds = {{
                title = "ğŸ“ æ¡é›†åˆ°çš„åº§æ¨™æ¸…å–®",
                description = desc,
                color = 0x00ff00
            }}
        })
        print("ğŸš€ å·²ç™¼é€åˆ° Discord")
        Locations = {} 
    end
end)
