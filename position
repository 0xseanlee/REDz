local UIS = game:GetService("UserInputService")
local Players = game:GetService("Players")

-- ã€è¨­å®šå€ã€‘
local LogKey = Enum.KeyCode.P      -- è¨˜éŒ„åº§æ¨™
local SendKey = Enum.KeyCode.Y     -- ç™¼é€åˆ° Discord
local ClearKey = Enum.KeyCode.T    -- ã€æ–°åŠŸèƒ½ã€‘æ¸…ç©ºç›®å‰æ¸…å–®
local WebhookURL = "https://discord.com/api/webhooks/1468528458056339529/WKTq9fLdmYaWVaM4b-yy78n9cEP5qB2NQx254k1pMLqJusi6HFefvtBL3vOaKznHoiFH"

local LastChatMessage = "æœªå‘½ååº§æ¨™"
local Locations = {}

-- åŸ·è¡Œå™¨å°ˆç”¨ç™¼é€å‡½æ•¸
local function SendToDiscord(payload)
    local request = (syn and syn.request) or (http and http.request) or http_request or (fluxus and fluxus.request)
    if request then
        request({
            Url = WebhookURL,
            Method = "POST",
            Headers = {["Content-Type"] = "application/json"},
            Body = game:GetService("HttpService"):JSONEncode(payload)
        })
    else
        warn("âŒ ä½ çš„åŸ·è¡Œå™¨ä¸æ”¯æŒ http_request å‡½æ•¸")
    end
end

-- ç›£è½èŠå¤©
Players.LocalPlayer.Chatted:Connect(function(msg)
    LastChatMessage = msg
    print("ğŸ“ å‚™è¨»å·²æ›´æ–°ç‚º: " .. msg)
end)

-- æŒ‰éµåˆ¤å®š
UIS.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    
    -- ã€Pã€‘è¨˜éŒ„åº§æ¨™
    if input.KeyCode == LogKey then
        local root = Players.LocalPlayer.Character and Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if root then
            local cf = root.CFrame
            local posString = string.format("CFrame.new(%.2f, %.2f, %.2f)", cf.X, cf.Y, cf.Z)
            table.insert(Locations, {Note = LastChatMessage, Code = posString})
            print("âœ… å·²éŒ„å…¥ (" .. #Locations .. "): " .. LastChatMessage)
        end

    -- ã€Tã€‘æ¸…ç©ºæ¸…å–®
    elseif input.KeyCode == ClearKey then
        Locations = {}
        print("ğŸ—‘ï¸ æ¸…å–®å·²å®Œå…¨æ¸…ç©ºï¼å¯ä»¥é‡æ–°é–‹å§‹è¨˜éŒ„ã€‚")

    -- ã€Yã€‘ç™¼é€åˆ° Discord
    elseif input.KeyCode == SendKey then
        if #Locations == 0 then 
            print("âš ï¸ ç›®å‰æ²’æœ‰ä»»ä½•åº§æ¨™å¯ä»¥ç™¼é€")
            return 
        end
        
        local desc = "```lua\nlocal Locations = {\n"
        for _, item in ipairs(Locations) do
            desc = desc .. '    ["' .. item.Note .. '"] = ' .. item.Code .. ",\n"
        end
        desc = desc .. "}\n```"

        SendToDiscord({
            embeds = {{
                title = "ğŸ“ æ‰¹é‡æ¡é›†åº§æ¨™å ±å‘Š",
                description = desc,
                color = 0x00ff00,
                footer = { text = "ç”±åº§æ¨™æ¡é›†åŠ©æ‰‹ç™¼é€ â€¢ ç¸½è¨ˆ " .. #Locations .. " å€‹é»ä½" }
            }}
        })
        
        print("ğŸš€ æ•¸æ“šå·²æˆåŠŸç™¼é€åˆ° Discordï¼Œæ¸…å–®å·²è‡ªå‹•é‡è¨­ã€‚")
        Locations = {} 
    end
end)

print("--- å¼·åŒ–ç‰ˆåº§æ¨™å·¥å…· ---")
print("P: è¨˜éŒ„ | T: æ¸…ç©º | Y: ç™¼é€")
