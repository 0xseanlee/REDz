local player = game.Players.LocalPlayer
local vUser = game:GetService("VirtualUser")

-- --- UI 建立 ---
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "CDK_Ultimate_Fix"
screenGui.Parent = player.PlayerGui
screenGui.ResetOnSpawn = false

local btn = Instance.new("TextButton")
btn.Size = UDim2.new(0, 160, 0, 50)
btn.Position = UDim2.new(0, 40, 0.4, 0)
btn.Text = "CDK WAKEUP: OFF"
btn.BackgroundColor3 = Color3.fromRGB(50, 20, 20)
btn.TextColor3 = Color3.new(1, 1, 1)
btn.Parent = screenGui
Instance.new("UICorner").Parent = btn

_G.Wakeup_Active = false

btn.MouseButton1Click:Connect(function()
    _G.Wakeup_Active = not _G.Wakeup_Active
    btn.Text = _G.Wakeup_Active and "CDK WAKEUP: ON" or "CDK WAKEUP: OFF"
    btn.BackgroundColor3 = _G.Wakeup_Active and Color3.fromRGB(255, 50, 50) or Color3.fromRGB(50, 20, 20)
end)

-- --- 核心：動作喚醒邏輯 ---
task.spawn(function()
    while true do
        if _G.Wakeup_Active then
            local success, err = pcall(function()
                local char = player.Character
                if not char or not char:FindFirstChild("Humanoid") then return end
                
                -- 尋找背包裡的 CDK 或 GHC
                local tool = player.Backpack:FindFirstChild("Cursed Dual Katana") or player.Backpack:FindFirstChild("Godhuman")
                
                if tool then
                    -- 1. 強制裝備 (這會觸發工具內部的 ChildAdded 腳本)
                    char.Humanoid:EquipTool(tool)
                    
                    -- 2. 捕捉控制並在裝備瞬間點擊
                    vUser:CaptureController()
                    vUser:Button1Down(Vector2.new(640, 360))
                    task.wait(0.05)
                    vUser:Button1Up(Vector2.new(640, 360))
                    
                    -- 3. 攻擊完立即卸下 (重置狀態)
                    task.wait(0.1)
                    tool.Parent = player.Backpack
                end
            end)
        end
        -- 隨機化節奏，給予武器裝備動畫的時間
        task.wait(math.random(4, 6) / 10)
    end
end)
