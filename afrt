local player = game.Players.LocalPlayer
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")

-- --- UI å»ºç«‹ ---
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "FruitFinder_UI"
screenGui.Parent = player:WaitForChild("PlayerGui")
screenGui.ResetOnSpawn = false

local btn = Instance.new("TextButton")
btn.Size = UDim2.new(0, 180, 0, 50)
btn.Position = UDim2.new(0, 40, 0.5, 0)
btn.Text = "AUTO FRUIT: OFF"
btn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
btn.TextColor3 = Color3.new(1, 1, 1)
btn.Font = Enum.Font.SourceSansBold
btn.TextSize = 18
btn.Parent = screenGui
Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 10)

-- --- æ ¸å¿ƒè®Šæ•¸ ---
_G.AutoFruit = false

btn.MouseButton1Click:Connect(function()
    _G.AutoFruit = not _G.AutoFruit
    btn.Text = _G.AutoFruit and "AUTO FRUIT: ON" or "AUTO FRUIT: OFF"
    btn.BackgroundColor3 = _G.AutoFruit and Color3.fromRGB(0, 150, 100) or Color3.fromRGB(40, 40, 40)
end)

-- --- å¹³æ»‘ç§»å‹• (Tween) å‡½æ•¸ ---
local function teleport(targetCFrame)
    local char = player.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return end
    
    local dist = (char.HumanoidRootPart.Position - targetCFrame.Position).Magnitude
    local speed = 300 -- ç§»å‹•é€Ÿåº¦ï¼Œä¸å®œå¤ªå¿«ä»¥å…è¢«åä½œå¼Šè¸¢å‡º
    local tweenInfo = TweenInfo.new(dist / speed, Enum.EasingStyle.Linear)
    
    local tween = TweenService:Create(char.HumanoidRootPart, tweenInfo, {CFrame = targetCFrame})
    tween:Play()
    return tween
end

-- --- å°‹æ‰¾ä¸¦æ’¿èµ·æœå¯¦ ---
task.spawn(function()
    while true do
        if _G.AutoFruit then
            pcall(function()
                local foundFruit = false
                
                -- éæ­·å·¥ä½œå€å¯»æ‰¾æœå¯¦
                for _, obj in pairs(game.Workspace:GetChildren()) do
                    -- Blox Fruits ç”Ÿæˆçš„æœå¯¦é€šå¸¸å¸¶æœ‰ "Fruit" åç¨±ä¸”æœ‰ Handle
                    if obj:IsA("Tool") and (obj.Name:find("Fruit") or obj:FindFirstChild("Handle")) then
                        foundFruit = true
                        local handle = obj:FindFirstChild("Handle") or obj:FindFirstChildOfClass("Part")
                        
                        if handle then
                            print("ğŸ ç™¼ç¾æœå¯¦: " .. obj.Name .. "ï¼Œæ­£åœ¨å‰å¾€...")
                            
                            -- 1. ç§»å‹•åˆ°æœå¯¦ä½ç½®
                            local tw = teleport(handle.CFrame)
                            if tw then tw.Completed:Wait() end
                            
                            -- 2. åˆ°é”å¾Œç¨ç­‰ï¼Œç¢ºä¿è§¸ç™¼æ’¿å–åˆ¤å®š
                            task.wait(0.3)
                            
                            -- 3. å¦‚æœæœå¯¦é‚„åœ¨åœ°ä¸Šï¼Œå˜—è©¦ç›´æ¥æ¥è§¸
                            if obj.Parent == game.Workspace then
                                player.Character.HumanoidRootPart.CFrame = handle.CFrame
                            end
                        end
                    end
                end
                
                if not foundFruit then
                    -- print("âŒ› ç›®å‰åœ°åœ–ä¸Šæ²’æœ‰æœå¯¦...")
                end
            end)
        end
        task.wait(5) -- æ¯ 5 ç§’æƒæä¸€æ¬¡å…¨åœ°åœ–ï¼Œç¯€çœæ•ˆèƒ½
    end
end)

-- --- é˜²æ‰è½/é˜²å¡ä½ ---
RunService.Stepped:Connect(function()
    if _G.AutoFruit then
        local char = player.Character
        if char and char:FindFirstChild("Humanoid") then
            -- é£›è¡Œæ™‚é˜²æ­¢è§’è‰²æ‰å…¥è™›ç©ºæˆ–è¢«é‡åŠ›å¹²æ“¾
            char.Humanoid:ChangeState(11) 
        end
    end
end)
