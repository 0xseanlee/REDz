local HttpService = game:GetService("HttpService")

-- ã€æ›´æ›ç‚ºä»£ç†ç¶²å€ï¼Œé˜²æ­¢ Discord å°é–ã€‘
local RawURL = "https://discord.com/api/webhooks/1468528458056339529/WKTq9fLdmYaWVaM4b-yy78n9cEP5qB2NQx254k1pMLqJusi6HFefvtBL3vOaKznHoiFH"
local WebhookURL = RawURL:gsub("discord.com", "hooks.hyra.io") 

-- æ¸¬è©¦ç™¼é€å‡½æ•¸
local function TestSend(msg)
    local request = (syn and syn.request) or (http and http.request) or http_request or (fluxus and fluxus.request)
    if request then
        local response = request({
            Url = WebhookURL,
            Method = "POST",
            Headers = {["Content-Type"] = "application/json"},
            Body = HttpService:JSONEncode({content = msg})
        })
        print("Webhook æ¸¬è©¦çµæœ: " .. tostring(response.StatusCode))
    else
        warn("ä½ çš„åŸ·è¡Œå™¨ä¸æ”¯æ´ Http Request")
    end
end

-- è…³æœ¬å•Ÿå‹•æ™‚å…ˆç™¼ä¸€å€‹æ¸¬è©¦ï¼Œçœ‹ Discord æœ‰æ²’æœ‰åæ‡‰
TestSend("ğŸš€ ä»»å‹™æ•¸æ“šæ¡é›†å™¨å·²é€£ç·šï¼")

-- ç›£è½ä»»å‹™æ•¸æ“š
local oldInvokeServer
oldInvokeServer = hookmetamethod(game, "__namecall", function(self, ...)
    local method = getnamecallmethod()
    local args = {...}

    if tostring(self) == "CommF_" and method == "InvokeServer" then
        if args[1] == "GetQuests" or args[1] == "CheckQuest" then
            task.spawn(function()
                local result = self:InvokeServer(unpack(args))
                if result and type(result) == "table" then
                    local taskList = "local QuestData = {\n"
                    for _, quest in pairs(result) do
                        taskList = taskList .. string.format('    ["%s"] = {LevelReq = %s},\n', tostring(quest.Name), tostring(quest.LevelReq or "0"))
                    end
                    taskList = taskList .. "}"
                    
                    TestSend("ğŸ“œ åµæ¸¬åˆ°ä»»å‹™ï¼š\n" .. taskList)
                end
            end)
        end
    end
    return oldInvokeServer(self, ...)
end)
